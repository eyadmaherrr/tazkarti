<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tazkarti Matches Reminder - منبه تذكرتي</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --tazkarti-green: #2e7d32;
            --tazkarti-light-green: #4caf50;
            --tazkarti-white: #ffffff;
            --tazkarti-light-gray: #f5f5f5;
            --tazkarti-dark-gray: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--tazkarti-light-gray);
            color: var(--tazkarti-dark-gray);
            line-height: 1.6;
        }

        header {
            background-color: var(--tazkarti-green);
            color: var(--tazkarti-white);
            padding: 1rem 2rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 10px;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 1.5rem;
        }

        nav ul li a {
            color: var(--tazkarti-white);
            text-decoration: none;
            font-weight: 500;
            transition: opacity 0.3s;
        }

        nav ul li a:hover {
            opacity: 0.8;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .section-title {
            color: var(--tazkarti-green);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--tazkarti-light-green);
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--tazkarti-green);
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--tazkarti-green);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .card {
            background-color: var(--tazkarti-white);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            background-color: var(--tazkarti-green);
            color: var(--tazkarti-white);
            padding: 1rem;
            font-weight: bold;
        }

        .card-body {
            padding: 1.5rem;
        }

        .card-item {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
        }

        .card-item i {
            color: var(--tazkarti-green);
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        .card-footer {
            background-color: var(--tazkarti-green);
            padding: 1rem;
            text-align: center;
        }

        .btn {
            display: inline-block;
            background-color: var(--tazkarti-green);
            color: var(--tazkarti-white);
            padding: 0.6rem 1.2rem;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.3s;
            border: none;
            cursor: pointer;
        }

        .btn:hover {
            background-color: var(--tazkarti-light-green);
        }

        .error-message {
            color: #d32f2f;
            background-color: #ffebee;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 2rem;
            border-left: 4px solid #d32f2f;
        }

        .price-tag {
            background-color: var(--tazkarti-light-green);
            color: white;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-weight: bold;
            display: inline-block;
            margin-top: 0.5rem;
        }

        footer {
            background-color: var(--tazkarti-green);
            color: var(--tazkarti-white);
            padding: 2rem;
            text-align: center;
            margin-top: 3rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .social-links {
            margin: 1rem 0;
        }

        .social-links a {
            color: var(--tazkarti-white);
            margin: 0 10px;
            font-size: 1.2rem;
            transition: color 0.3s;
        }

        .social-links a:hover {
            color: var(--tazkarti-dark-gray);
        }

        /* Notification Styles */
        .notification-bell {
            position: relative;
            margin-left: 1.5rem;
            cursor: pointer;
            color: white;
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #f44336;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-panel {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 350px;
            background: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            z-index: 1000;
            display: none;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .notification-item {
            padding: 12px 16px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .notification-item:hover {
            background-color: #f9f9f9;
        }
        
        .notification-item.unread {
            background-color: #f0f7ff;
        }
        
        .notification-title {
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .notification-time {
            font-size: 12px;
            color: #666;
        }

        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                text-align: center;
            }

            nav ul {
                margin-top: 1rem;
                justify-content: center;
            }

            nav ul li {
                margin: 0 0.75rem;
            }

            .card-grid {
                grid-template-columns: 1fr;
            }

            .notification-panel {
                width: 280px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-ticket-alt"></i>
                <span>Tazkarti Matches Reminder - منبه تذكرتي</span>
            </div>
            <nav>
                <ul>
                    <li><a href="#matches">Matches - مباريات</a></li>
                    <li><a href="#events">Events - فعاليات</a></li>
                    <li>
                        <div class="notification-bell" id="notificationBell">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                        </div>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header" style="padding: 12px 16px; border-bottom: 1px solid #eee; font-weight: bold;">
            Notifications - الإشعارات
            <button id="clearNotifications" style="float: right; background: none; border: none; cursor: pointer; color: var(--tazkarti-green);">
                Clear All - مسح الكل
            </button>
        </div>
        <div id="notificationList"></div>
    </div>

    <div class="container">
        <!-- Matches Section -->
        <section id="matches">
            <h2 class="section-title"><i class="fas fa-futbol"></i> Upcoming Matches - مباريات القادمة</h2>
            <div id="matches-loading" class="loading">
                <div class="spinner"></div>
                <p>Loading matches...</p>
            </div>
            <div id="matches-error" class="error-message" style="display: none;">
                <i class="fas fa-exclamation-circle"></i> Failed to load matches. Please try again later.
            </div>
            <div id="matches-container" class="card-grid" style="display: none;"></div>
        </section>

        <!-- Events Section -->
        <section id="events">
            <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Upcoming Events - الفعاليات القادمة</h2>
            <div id="events-loading" class="loading">
                <div class="spinner"></div>
                <p>Loading events...</p>
            </div>
            <div id="events-error" class="error-message" style="display: none;">
                <i class="fas fa-exclamation-circle"></i> Failed to load events. Please try again later.
            </div>
            <div id="events-container" class="card-grid" style="display: none;"></div>
        </section>
    </div>

    <footer>
        <div class="footer-content">
            <div class="logo">
                <i class="fas fa-ticket-alt"></i>
                <span>Tazkarti Matches Reminder - منبه تذكرتي</span>
            </div>
            <p></p>
            <div class="social-links">
                <a href="https://instagram.com/eyadmaherrr"><i class="fab fa-instagram"></i></a>
                <a href="https://wa.me/+201001663360"><i class="fab fa-whatsapp"></i></a>
                <a href="https://x.com/@eyadmaherrr"><i class="fab fa-twitter"></i></a>
            </div>
            <p>By: @eyadmaherrr</p>
        </div>
    </footer>

    <script>
        // Store the last known events and matches for comparison
        let lastKnownEvents = [];
        let lastKnownMatches = [];
        let notifications = JSON.parse(localStorage.getItem('tazkarti_notifications')) || [];
        let isMobileDevice = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize notification UI
            updateNotificationUI();
            
            // Request notification permission
            requestNotificationPermission();
            
            // Setup notification bell click handler
            document.getElementById('notificationBell').addEventListener('click', function() {
                const panel = document.getElementById('notificationPanel');
                panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
                
                // Mark notifications as read when panel is opened
                if (panel.style.display === 'block') {
                    markNotificationsAsRead();
                }
            });
            
            // Clear notifications button
            document.getElementById('clearNotifications').addEventListener('click', function(e) {
                e.stopPropagation();
                notifications = [];
                saveNotifications();
                updateNotificationUI();
            });
            
            // Close notification panel when clicking outside
            document.addEventListener('click', function(event) {
                const panel = document.getElementById('notificationPanel');
                const bell = document.getElementById('notificationBell');
                
                if (!panel.contains(event.target) && !bell.contains(event.target)) {
                    panel.style.display = 'none';
                }
            });
            
            // Mobile-specific touch handlers
            if (isMobileDevice) {
                setupMobileFeatures();
            }
            
            // Initial load of data
            loadData();
            
            // Poll for new data every 5 minutes (300000ms)
            setInterval(loadData, 300000);
        });
        
        function setupMobileFeatures() {
            // Add swipe to refresh
            let touchstartY = 0;
            let touchendY = 0;
            
            document.addEventListener('touchstart', e => {
                touchstartY = e.changedTouches[0].screenY;
            }, {passive: true});
            
            document.addEventListener('touchend', e => {
                touchendY = e.changedTouches[0].screenY;
                handleSwipe();
            }, {passive: true});
            
            function handleSwipe() {
                if (touchstartY - touchendY > 100 && window.scrollY === 0) {
                    // Swipe down from top - refresh
                    loadData();
                    showMobileToast("Refreshing data...");
                }
            }
        }
        
        function requestNotificationPermission() {
            if ('Notification' in window) {
                // Check if we're on iOS
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                             (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
                
                if (isIOS) {
                    // iOS doesn't support notifications well - show alternative message
                    console.log("iOS detected - using fallback notification system");
                    return;
                }
                
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('Notification permission granted');
                        // Register service worker for push notifications
                        registerServiceWorker();
                    }
                });
            }
        }
        
        function registerServiceWorker() {
            if ('serviceWorker' in navigator && 'PushManager' in window) {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('Service Worker registered');
                        return registration.pushManager.getSubscription()
                            .then(subscription => {
                                if (subscription) return subscription;
                                return registration.pushManager.subscribe({
                                    userVisibleOnly: true,
                                    applicationServerKey: urlBase64ToUint8Array('YOUR_VAPID_PUBLIC_KEY')
                                });
                            });
                    })
                    .then(subscription => {
                        console.log('Push subscription successful');
                        // Here you would typically send the subscription to your server
                    })
                    .catch(err => {
                        console.log('Service Worker registration failed: ', err);
                    });
            }
        }
        
        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding)
                .replace(/-/g, '+')
                .replace(/_/g, '/');
            
            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);
            
            for (let i = 0; i < rawData.length; ++i) {
                outputArray[i] = rawData.charCodeAt(i);
            }
            return outputArray;
        }
        
        function loadData() {
            showMobileToast("Loading data...");
            
            // Load matches data
            fetch('https://corsproxy.io/?https://tazkarti.com/data/matches-list-json.json')
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    document.getElementById('matches-loading').style.display = 'none';
                    if (data && data.length > 0) {
                        checkForNewMatches(data);
                        displayMatches(data);
                        document.getElementById('matches-container').style.display = 'grid';
                        lastKnownMatches = data;
                    } else {
                        document.getElementById('matches-error').textContent = 'No matches available at this time.';
                        document.getElementById('matches-error').style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error loading matches:', error);
                    document.getElementById('matches-loading').style.display = 'none';
                    document.getElementById('matches-error').style.display = 'block';
                    showMobileToast("Failed to load matches", true);
                });
            
            // Load events data
            fetch('https://corsproxy.io/?https://tazkarti.com/data/events-list-json.json')
                .then(response => {
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.json();
                })
                .then(data => {
                    document.getElementById('events-loading').style.display = 'none';
                    if (data && data.length > 0) {
                        checkForNewEvents(data);
                        displayEvents(data);
                        document.getElementById('events-container').style.display = 'grid';
                        lastKnownEvents = data;
                    } else {
                        document.getElementById('events-error').textContent = 'No events available at this time.';
                        document.getElementById('events-error').style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error loading events:', error);
                    document.getElementById('events-loading').style.display = 'none';
                    document.getElementById('events-error').style.display = 'block';
                    showMobileToast("Failed to load events", true);
                });
        }
        
        function checkForNewEvents(currentEvents) {
            if (lastKnownEvents.length === 0) return;
            
            const newEvents = currentEvents.filter(currentEvent => 
                !lastKnownEvents.some(lastEvent => lastEvent.id === currentEvent.id)
            );
            
            newEvents.forEach(event => {
                const notification = {
                    id: Date.now(),
                    type: 'event',
                    title: `New Event: ${event.name}`,
                    message: event.summary ? event.summary.replace(/<[^>]*>/g, '').substring(0, 100) + '...' : '',
                    time: new Date(),
                    read: false,
                    eventId: event.id
                };
                
                notifications.unshift(notification);
                showNotification(notification);
            });
            
            if (newEvents.length > 0) {
                saveNotifications();
                updateNotificationUI();
                showMobileToast(`${newEvents.length} new events added`);
            }
        }
        
        function checkForNewMatches(currentMatches) {
            if (lastKnownMatches.length === 0) return;
            
            const newMatches = currentMatches.filter(currentMatch => 
                !lastKnownMatches.some(lastMatch => lastMatch.id === currentMatch.id)
            );
            
            newMatches.forEach(match => {
                const notification = {
                    id: Date.now(),
                    type: 'match',
                    title: `New Match: ${match.home_team || 'Team A'} vs ${match.away_team || 'Team B'}`,
                    message: `${match.competition || 'Match'} at ${match.venue || 'unknown venue'}`,
                    time: new Date(),
                    read: false,
                    matchId: match.id
                };
                
                notifications.unshift(notification);
                showNotification(notification);
            });
            
            if (newMatches.length > 0) {
                saveNotifications();
                updateNotificationUI();
                showMobileToast(`${newMatches.length} new matches added`);
            }
        }
        
        function showNotification(notification) {
            // Check if we should show mobile fallback
            if (isMobileDevice && (Notification.permission !== 'granted' || !('Notification' in window))) {
                showInAppNotification(notification);
                return;
            }
            
            if (Notification.permission === 'granted') {
                const options = {
                    body: notification.message,
                    icon: '/icons/icon-192x192.png',
                    badge: '/icons/badge-72x72.png',
                    vibrate: isMobileDevice ? [200, 100, 200] : undefined,
                    data: { 
                        url: window.location.href.split('#')[0] + '#' + notification.type,
                        id: notification.id
                    }
                };
                
                if ('serviceWorker' in navigator) {
                    // Try to show via service worker (works when tab is closed)
                    navigator.serviceWorker.ready.then(registration => {
                        registration.showNotification(notification.title, options);
                    }).catch(err => {
                        // Fallback to regular notification
                        new Notification(notification.title, options);
                    });
                } else {
                    // Regular notification
                    new Notification(notification.title, options);
                }
            } else if (isMobileDevice) {
                // Fallback for mobile - show in-app notification
                showInAppNotification(notification);
            }
        }
        
        function showInAppNotification(notification) {
            // Create mobile-friendly notification element
            const notifElement = document.createElement('div');
            notifElement.style.position = 'fixed';
            notifElement.style.bottom = '20px';
            notifElement.style.right = '20px';
            notifElement.style.left = '20px';
            notifElement.style.backgroundColor = 'white';
            notifElement.style.padding = '15px';
            notifElement.style.borderRadius = '8px';
            notifElement.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
            notifElement.style.zIndex = '1000';
            notifElement.style.display = 'flex';
            notifElement.style.flexDirection = 'column';
            notifElement.style.gap = '8px';
            notifElement.style.transform = 'translateY(100px)';
            notifElement.style.transition = 'transform 0.3s ease-out';
            
            notifElement.innerHTML = `
                <strong style="color: var(--tazkarti-green)">${notification.title}</strong>
                <div>${notification.message}</div>
                <div style="font-size: 12px; color: #666">${formatTime(notification.time)}</div>
            `;
            
            document.body.appendChild(notifElement);
            
            // Animate in
            setTimeout(() => {
                notifElement.style.transform = 'translateY(0)';
            }, 10);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                notifElement.style.transform = 'translateY(100px)';
                setTimeout(() => notifElement.remove(), 300);
            }, 5000);
            
            // Click handler to go to relevant section
            notifElement.addEventListener('click', () => {
                window.location.hash = notification.type;
                document.getElementById(notification.type).scrollIntoView();
                notifElement.remove();
            });
        }
        
        function showMobileToast(message, isError = false) {
            if (!isMobileDevice) return;
            
            const toast = document.createElement('div');
            toast.style.position = 'fixed';
            toast.style.bottom = '20px';
            toast.style.left = '50%';
            toast.style.transform = 'translateX(-50%)';
            toast.style.backgroundColor = isError ? '#f44336' : 'var(--tazkarti-green)';
            toast.style.color = 'white';
            toast.style.padding = '10px 20px';
            toast.style.borderRadius = '20px';
            toast.style.zIndex = '1000';
            toast.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
            toast.style.opacity = '0';
            toast.style.transition = 'opacity 0.3s';
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // Fade in
            setTimeout(() => {
                toast.style.opacity = '1';
            }, 10);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        function updateNotificationUI() {
            const unreadCount = notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notificationBadge');
            
            if (unreadCount > 0) {
                badge.style.display = 'flex';
                badge.textContent = unreadCount > 9 ? '9+' : unreadCount.toString();
            } else {
                badge.style.display = 'none';
            }
            
            // Update notification list
            const notificationList = document.getElementById('notificationList');
            notificationList.innerHTML = '';
            
            if (notifications.length === 0) {
                notificationList.innerHTML = '<div style="padding: 16px; text-align: center; color: #666;">No notifications - لا توجد إشعارات</div>';
                return;
            }
            
            notifications.forEach(notification => {
                const item = document.createElement('div');
                item.className = `notification-item ${notification.read ? '' : 'unread'}`;
                item.innerHTML = `
                    <div class="notification-title">${notification.title}</div>
                    <div class="notification-message">${notification.message}</div>
                    <div class="notification-time">${formatTime(notification.time)}</div>
                `;
                
                item.addEventListener('click', () => {
                    // Mark as read when clicked
                    notification.read = true;
                    saveNotifications();
                    updateNotificationUI();
                    
                    // Scroll to relevant section
                    window.location.hash = notification.type;
                    document.getElementById(notification.type).scrollIntoView();
                    
                    // Close notification panel
                    document.getElementById('notificationPanel').style.display = 'none';
                });
                
                notificationList.appendChild(item);
            });
        }
        
        function markNotificationsAsRead() {
            let needsUpdate = false;
            notifications.forEach(notification => {
                if (!notification.read) {
                    notification.read = true;
                    needsUpdate = true;
                }
            });
            
            if (needsUpdate) {
                saveNotifications();
                updateNotificationUI();
            }
        }
        
        function saveNotifications() {
            // Keep only the 50 most recent notifications
            if (notifications.length > 50) {
                notifications = notifications.slice(0, 50);
            }
            localStorage.setItem('tazkarti_notifications', JSON.stringify(notifications));
        }
        
        function formatTime(date) {
            if (!(date instanceof Date)) {
                date = new Date(date);
            }
            
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now - للتو';
            if (diff < 3600000) return `${Math.floor(diff / 60000)} min ago - منذ ${Math.floor(diff / 60000)} دقيقة`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)} hour${Math.floor(diff / 3600000) > 1 ? 's' : ''} ago - منذ ${Math.floor(diff / 3600000)} ساعة`;
            
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
        
        function displayMatches(matches) {
            const container = document.getElementById('matches-container');
            container.innerHTML = '';
            
            matches.forEach(match => {
                const matchCard = document.createElement('div');
                matchCard.className = 'card';
                
                // Format date and time
                const matchDate = match.date ? new Date(match.date).toLocaleDateString() : 'Date not specified';
                const matchTime = match.time || 'Time not specified';
                
                matchCard.innerHTML = `
                    <div class="card-header">${match.league || 'Match'}</div>
                    <div class="card-body">
                        <div class="card-item" style="justify-content: center; margin-bottom: 1.5rem; font-weight: bold;">
                            <span>${match.home_team || 'Team A'} vs ${match.away_team || 'Team B'}</span>
                        </div>
                        <div class="card-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${match.venue || 'Venue not specified'}</span>
                        </div>
                        <div class="card-item">
                            <i class="fas fa-calendar-day"></i>
                            <span>${matchDate}</span>
                        </div>
                        <div class="card-item">
                            <i class="fas fa-clock"></i>
                            <span>${matchTime}</span>
                        </div>
                        <div class="card-item">
                            <i class="fas fa-trophy"></i>
                            <span>${match.competition || 'Competition not specified'}</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <a href="${match.ticket_url || 'https://tazkarti.com/#/profile'}" class="btn">Buy Tickets - شراء التذاكر</a>
                    </div>
                `;
                
                container.appendChild(matchCard);
            });
        }
    
        function displayEvents(events) {
            const container = document.getElementById('events-container');
            container.innerHTML = '';
            
            events.forEach(event => {
                const eventCard = document.createElement('div');
                eventCard.className = 'card';
                
                // Format dates and get first show time if available
                const startDate = event.startDate ? new Date(event.startDate).toLocaleDateString() : 'Date not specified';
                const firstShow = event.shows && event.shows.length > 0 ? event.shows[0] : null;
                const showTime = firstShow ? new Date(firstShow.startDate).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : 'Time not specified';
                
                eventCard.innerHTML = `
                    <div class="card-header">${event.name || 'Event'}</div>
                    <div class="card-body">
                        <div class="card-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${event.venue?.name || event.venue?.location || 'Location not specified'}</span>
                        </div>
                        <div class="card-item">
                            <i class="fas fa-calendar-day"></i>
                            <span>${startDate}</span>
                        </div>
                        <div class="card-item">
                            <i class="fas fa-clock"></i>
                            <span>${showTime}</span>
                        </div>
                        <div class="card-item">
                            <i class="fas fa-info-circle"></i>
                            <span>${event.summary ? event.summary.replace(/<[^>]*>/g, '').substring(0, 100) + '...' : 'No description available'}</span>
                        </div>
                        <div class="price-tag">
                            From ${event.minimumPrice ? `${event.minimumPrice} EGP` : 'N/A'}
                        </div>
                    </div>
                    <div class="card-footer">
                        <a href="https://tazkarti.com/#/profile" class="btn">Get Tickets - احصل على التذاكر</a>
                    </div>
                `;
                
                container.appendChild(eventCard);
            });
        }
        // In-app notifications (works everywhere)
function showNotification(title, message) {
    const notification = document.createElement('div');
    notification.className = 'in-app-notification';
    notification.innerHTML = `
      <h4>${title}</h4>
      <p>${message}</p>
    `;
    document.body.appendChild(notification);
    setTimeout(() => notification.remove(), 5000);
  }
  
  // Browser notifications (works on Desktop/Android)
  function requestNotificationPermission() {
    if ('Notification' in window) {
      Notification.requestPermission().then(permission => {
        if (permission === 'granted') {
          console.log('Notification permission granted');
        }
      });
    }
  }
  
  // Example: Show notification when new matches are found
  function checkForNewMatches(matches) {
    if (matches.length > lastKnownMatches.length) {
      const newMatches = matches.length - lastKnownMatches.length;
      showNotification(
        "New Matches!",
        `${newMatches} new matches available`
      );
      // Browser notification (if permitted)
      if (Notification.permission === 'granted') {
        new Notification("Tazkarti Update", {
          body: `Check out ${newMatches} new matches!`,
          icon: '/icons/icon-192.png'
        });
      }
    }
  }
    </script>
</body>
</html>